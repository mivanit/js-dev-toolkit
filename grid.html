<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataTable Demo</title>
    <style>
        .datatable {
            border-collapse: collapse;
            width: 100%;
        }

        .datatable th,
        .datatable td {
            border: 1px solid #ccc;
            padding: 8px;
        }

        .datatable th {
            background: #f0f0f0;
            cursor: pointer;
        }

        .datatable-filter-input {
            width: 100%;
            border: none;
            padding: 4px;
        }
    </style>
</head>

<body>
    <div class="container">
        <h1>DataTable Demo</h1>
        <div id="table-container"></div>
    </div>
    <script src="src/DataFrame.js"></script>
    <script src="src/table.js"></script>
    <script>
        let table = null;

        // Sample data generator
        function generateSampleData(count = 100) {
            // const names = ['Alice Johnson', 'Bob Smith', 'Carol Williams', 'David Brown', 'Eve Davis',
            //     'Frank Miller', 'Grace Wilson', 'Henry Moore', 'Iris Taylor', 'Jack Anderson',
            //     'Karen White', 'Leo Garcia', 'Mia Rodriguez', 'Noah Thompson', 'Olivia Martinez'];
            const first_names = ['Alice', 'Bob', 'Carol', 'David', 'Eve', 'Frank', 'Grace', 'Henry', 'Iris', 'Jack', 'Karen', 'Leo', 'Mia', 'Noah', 'Olivia'];
            const last_names = ['Johnson', 'Smith', 'Williams', 'Brown', 'Davis', 'Miller', 'Wilson', 'Moore', 'Taylor', 'Anderson', 'White', 'Garcia', 'Rodriguez', 'Thompson', 'Martinez'];
            const names = [];
            for (let i = 0; i < first_names.length; i++) {
                for (let j = 0; j < last_names.length; j++) {
                    names.push(first_names[i] + ' ' + last_names[j]);
                }
            }
            const departments = ['Engineering', 'Marketing', 'Sales', 'HR', 'Finance'];

            const data = [];
            for (let i = 0; i < count; i++) {
                data.push({
                    id: 1000 + i,
                    name: names[Math.floor(Math.random() * names.length)],
                    age: Math.floor(Math.random() * 40) + 22,
                    salary: Math.round((Math.random() * 50000 + 45000) * 100) / 100,
                    department: departments[Math.floor(Math.random() * departments.length)],
                    score: Math.round((Math.random() * 40 + 60) * 10) / 10,
                    startDate: new Date(2020 + Math.floor(Math.random() * 4),
                        Math.floor(Math.random() * 12),
                        Math.floor(Math.random() * 28) + 1)
                });
            }
            return data;
        }

        // Custom renderers - simple without CSS classes
        const scoreRenderer = (value, row, col) => {
            const color = value >= 85 ? 'green' : value >= 70 ? 'orange' : 'red';
            return `<span style="color: ${color}; font-weight: bold;">${value.toFixed(1)}</span>`;
        };

        const departmentRenderer = (value, row, col) => {
            const colors = {
                'Engineering': 'blue',
                'Marketing': 'purple',
                'Sales': 'green',
                'HR': 'brown',
                'Finance': 'navy'
            };
            const color = colors[value] || 'black';
            return `<span style="color: ${color};">${value}</span>`;
        };

        const salaryRenderer = (value, row, col) => {
            return '$' + value.toLocaleString('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        };

        const dateRenderer = (value, row, col) => {
            return value.toLocaleDateString('en-US');
        };

        // Initialize with sample data
        function loadSampleData() {
            const data = generateSampleData(150);
            const columns = [
                { key: 'id', label: 'ID', type: 'number', width: '80px', align: 'right', filterable: false }, // Disable filtering for ID
                { key: 'name', label: 'Name', type: 'string', width: '150px' },
                { key: 'age', label: 'Age', type: 'number', width: '70px', align: 'center' },
                { key: 'salary', label: 'Salary', type: 'number', width: '120px', align: 'right', renderer: salaryRenderer },
                { key: 'department', label: 'Department', type: 'string', width: '120px', align: 'center', renderer: departmentRenderer },
                { key: 'score', label: 'Score', type: 'number', width: '80px', align: 'center', renderer: scoreRenderer },
                { key: 'startDate', label: 'Start Date', type: 'date', width: '120px', align: 'center', renderer: dateRenderer, filterable: false }
            ];

            table = new DataTable('#table-container', {
                data: data,
                columns: columns,
                pageSize: 15,
                pageSizeOptions: [5, 15, 30, 50],
                showFilters: true, // Enable filter row (default is true)
                filterConfigs: {
                    name: {
                        tooltip: 'Filter names (prefix with ^ for "starts with")',
                        filterFunction: (input) => {
                            // Custom filter: case-insensitive with "starts with" support
                            const searchTerm = input.toLowerCase().trim();
                            if (!searchTerm) return () => true;

                            // Support "starts with" using ^ prefix
                            if (searchTerm.startsWith('^')) {
                                const term = searchTerm.substring(1);
                                return (value) => String(value).toLowerCase().startsWith(term);
                            }

                            // Default: case-insensitive contains
                            return (value) => String(value).toLowerCase().includes(searchTerm);
                        }
                    },
                    age: {
                        tooltip: 'Filter by age: use >, <, >=, <=, ==, != (e.g., >30, <=45)'
                    },
                    salary: {
                        tooltip: 'Filter by salary: use operators (e.g., >50000, <=75000)'
                    },
                    department: {
                        tooltip: 'Filter by department (try abbreviations: eng, mkt, fin)',
                        filterFunction: (input) => {
                            // Custom filter: match department abbreviations
                            const searchTerm = input.toLowerCase().trim();
                            if (!searchTerm) return () => true;

                            // Map common abbreviations to full names
                            const abbrevMap = {
                                'eng': 'engineering',
                                'mkt': 'marketing',
                                'fin': 'finance'
                            };

                            const normalizedSearch = abbrevMap[searchTerm] || searchTerm;

                            return (value) => {
                                const dept = String(value).toLowerCase();
                                return dept.includes(normalizedSearch);
                            };
                        }
                    },
                    score: {
                        tooltip: 'Filter scores: use operators or letter grades (A, B, C, D, F)',
                        filterFunction: (input) => {
                            // Custom filter: support letter grades
                            const trimmed = input.trim().toUpperCase();

                            // Support letter grades
                            const gradeRanges = {
                                'A': [90, 100],
                                'B': [80, 89.9],
                                'C': [70, 79.9],
                                'D': [60, 69.9],
                                'F': [0, 59.9]
                            };

                            if (gradeRanges[trimmed]) {
                                const [min, max] = gradeRanges[trimmed];
                                return (value) => value >= min && value <= max;
                            }

                            // Fall back to default number filtering
                            return null; // Let the default number filter handle it
                        }
                    }
                }
            });
        }


        // Load sample data on page load
        loadSampleData();
    </script>
</body>

</html>