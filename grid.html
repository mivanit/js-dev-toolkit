<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DataTable Demo</title>
    <style>
        .datatable { border-collapse: collapse; width: 100%; }
        .datatable th, .datatable td { border: 1px solid #ccc; padding: 8px; }
        .datatable th { background: #f0f0f0; cursor: pointer; }
        .datatable-filter-input { width: 100%; border: none; padding: 4px; }
    </style>
</head>
<body>
    <div class="container">
        <h1>DataTable Demo</h1>

        <div>
            <button onclick="loadSampleData()">Load Sample Data</button>
            <button onclick="loadFromCSV()">Load from CSV</button>
            <button onclick="addRandomRow()">Add Random Row</button>
            <button onclick="exportData()">Export CSV</button>
            <label>Page Size:
                <select id="pageSize" onchange="changePageSize()">
                    <option value="10">10</option>
                    <option value="25" selected>25</option>
                    <option value="50">50</option>
                    <option value="100">100</option>
                </select>
            </label>
        </div>

        <div>
            <h3>Custom CSV Data:</h3>
            <textarea id="csv-input" placeholder="Paste CSV data here...">name,age,salary,department,score
John Doe,30,75000.50,Engineering,85.2
Jane Smith,25,68000.00,Marketing,92.1
Bob Johnson,35,82000.75,Engineering,78.9
Alice Brown,28,71000.25,Sales,88.7
Charlie Wilson,32,79000.00,Engineering,91.3
Diana Davis,26,65000.50,Marketing,86.4
Eve Miller,29,73000.75,Sales,89.8
Frank Garcia,34,81000.00,Engineering,76.5
Grace Taylor,27,69500.25,Marketing,90.3
Henry Martinez,31,77500.50,Sales,83.1</textarea>
        </div>

        <div id="table-container"></div>
    </div>

    <script src="src/DataFrame.js"></script>
    <script src="src/table.js"></script>

    <script>
        let table = null;

        // Sample data generator
        function generateSampleData(count = 100) {
            const names = ['Alice Johnson', 'Bob Smith', 'Carol Williams', 'David Brown', 'Eve Davis',
                          'Frank Miller', 'Grace Wilson', 'Henry Moore', 'Iris Taylor', 'Jack Anderson',
                          'Karen White', 'Leo Garcia', 'Mia Rodriguez', 'Noah Thompson', 'Olivia Martinez'];
            const departments = ['Engineering', 'Marketing', 'Sales', 'HR', 'Finance'];

            const data = [];
            for (let i = 0; i < count; i++) {
                data.push({
                    id: 1000 + i,
                    name: names[Math.floor(Math.random() * names.length)],
                    age: Math.floor(Math.random() * 40) + 22,
                    salary: Math.round((Math.random() * 50000 + 45000) * 100) / 100,
                    department: departments[Math.floor(Math.random() * departments.length)],
                    score: Math.round((Math.random() * 40 + 60) * 10) / 10,
                    startDate: new Date(2020 + Math.floor(Math.random() * 4),
                                       Math.floor(Math.random() * 12),
                                       Math.floor(Math.random() * 28) + 1)
                });
            }
            return data;
        }

        // Custom renderers - simple without CSS classes
        const scoreRenderer = (value, row, col) => {
            const color = value >= 85 ? 'green' : value >= 70 ? 'orange' : 'red';
            return `<span style="color: ${color}; font-weight: bold;">${value.toFixed(1)}</span>`;
        };

        const departmentRenderer = (value, row, col) => {
            const colors = {
                'Engineering': 'blue',
                'Marketing': 'purple',
                'Sales': 'green',
                'HR': 'brown',
                'Finance': 'navy'
            };
            const color = colors[value] || 'black';
            return `<span style="color: ${color};">${value}</span>`;
        };

        const salaryRenderer = (value, row, col) => {
            return '$' + value.toLocaleString('en-US', {
                minimumFractionDigits: 2,
                maximumFractionDigits: 2
            });
        };

        const dateRenderer = (value, row, col) => {
            return value.toLocaleDateString('en-US');
        };

        // Initialize with sample data
        function loadSampleData() {
            const data = generateSampleData(150);
            const columns = [
                { key: 'id', label: 'ID', type: 'number' },
                { key: 'name', label: 'Name', type: 'string' },
                { key: 'age', label: 'Age', type: 'number' },
                { key: 'salary', label: 'Salary', type: 'number', renderer: salaryRenderer },
                { key: 'department', label: 'Department', type: 'string', renderer: departmentRenderer },
                { key: 'score', label: 'Score', type: 'number', renderer: scoreRenderer },
                { key: 'startDate', label: 'Start Date', type: 'date', renderer: dateRenderer }
            ];

            table = new DataTable('#table-container', {
                data: data,
                columns: columns,
                pageSize: 25
            });
        }

        function loadFromCSV() {
            const csvText = document.getElementById('csv-input').value.trim();
            if (!csvText) {
                alert('Please enter CSV data first');
                return;
            }

            try {
                // Use DataFrame to parse CSV
                const df = DataFrame.from_csv(csvText);
                const data = df.data;
                const columns = df.columns.map(col => ({
                    key: col,
                    label: col.charAt(0).toUpperCase() + col.slice(1),
                    type: typeof data[0][col] === 'number' ? 'number' : 'string'
                }));

                table = new DataTable('#table-container', {
                    data: data,
                    columns: columns,
                    pageSize: 10
                });
            } catch (error) {
                alert('Error parsing CSV: ' + error.message);
            }
        }

        function addRandomRow() {
            if (!table) {
                alert('Please load data first');
                return;
            }

            const newRow = generateSampleData(1)[0];
            table.addRow(newRow);
        }

        function changePageSize() {
            if (!table) {
                alert('Please load data first');
                return;
            }

            const select = document.getElementById('pageSize');
            const size = parseInt(select.value);
            table.setPageSize(size);
        }

        function exportData() {
            if (!table) {
                alert('Please load data first');
                return;
            }

            const csv = table.exportCSV();
            const blob = new Blob([csv], { type: 'text/csv' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'table-data.csv';
            a.click();
            URL.revokeObjectURL(url);
        }

        // Load sample data on page load
        loadSampleData();
    </script>
</body>
</html>